\subsection{Numerical Methods}

\subsubsection{Discrete Euler-Maruyama}
Given $N \in \mathbb{N}$ let us define a partition of $[0,T]$ as $P_h = \{t_i\}_{i=0}^{N}, t_i = ih, h = T/N$. The Discrete Euler-Maruyama method (DEM) for problem \eqref{eq:GeneralModel} is defined as follows
\begin{equation}\label{eq:DEM}
	\begin{cases}
		X_h^d(t_{i+1}) = f(X(t_i))h + g(X(t_i))(W(t_{i+1}) - W(t_{i})),  \\
		X_h^d(0) = X_0.
	\end{cases}
\end{equation} 
The exit time $\tau$ is approximated with the quantity $\tau_h^d$ defined as 
\begin{equation}\label{eq:TauDEM}
	\tau_h^d = \min\{\min \{t_i \colon X_h^d(t_i) \notin D\},T\}.
\end{equation}
We approximate analogously $\phi$ as
\begin{equation}\label{eq:PhiDEM}
	 \phi_h^d = \mathbbm{1}_{\{\tau_h^d < T\}}F(X_h^d(T)).
\end{equation}
Let us state two results concerning the weak error of this method.
\begin{theorem}\label{ThDEMTau} Under appropriate assumptions of smoothness of $f,g,D,\partial D,F$,
\begin{equation}\label{eq:ConvDEMTau}
	|\mathbb{E}(\tau_h^d) - \mathbb{E}(\tau)| = O(\sqrt{h}).
\end{equation}
\end{theorem}
\begin{theorem}\label{ThDEMPhi} Under approprate assumptions of smoothness of $f,g,D,\partial D,F$,
\begin{equation}\label{eq:ConvDEMPhi}
	|\mathbb{E}(\phi_h^d) - \mathbb{E}(\phi)| = O(\sqrt{h}).
\end{equation}	
\end{theorem}
An discussion of result \ref{ThDEMTau} can be found in \cite{Higham2013}, its proof in \cite{Gobet2010}. A proof of \ref{ThDEMPhi} can be found in \cite{Gobet2000}.

\subsubsection{Continuous Euler-Maruyama. }
Let us consider the partition $P_h$ of $[0,T]$ as above. The Continuous Euler-Maruyama (CEM) method is defined as
\begin{equation}\label{eq:CEM}
	\begin{cases}
		X_h^c(t) = f(X(t_i))(t-t_i) + g(X(t_i))(W(t) - W(t_{i})),  & t_i < t \leq t_{i+1},\\
		X_h^c(0) = X_0.
	\end{cases}
\end{equation} 
Let us remark that in case the particle does not exit the domain, $X_h^c(t_i) = X_h^d(t_i)$ for all $t_i \in P_h$. It is possible to compute the probability that a particle has exited the domain at a time $t$ between two consecutive timesteps $t_i,t_{i+1}$ when $D$ is an half-space with the following formula \cite{Gobet2001}
\begin{equation}\label{eq:CEMProb}
	\mathbb{P} (\exists t \in [ t_i,t_{i+1} ] \quad X_h^d(t) \notin D | X_h^d(t_i) = x_i, X_h^d(t_{i+1}) = x_{i+1}) = p(x_i,x_{i+1},h),
\end{equation}
with $p(x_i,x_{i+1},h)$ given by
\begin{equation}\label{eq:CEMProbHalfSpace}
	p(x_i,x_{i+1},h) = \exp\Big(-2\frac{[n\cdot(x_i - z_i)][n\cdot(x_{i+1} - z_i)]}{hn\cdot (gg^T(x_i)n)}\Big),
\end{equation}
where $z_i$ is the projection of $x_i$ on $\partial D$ and $n$ is the normal to $\partial D$ in $z_i$. At each timestep $t_{i+1}$ we compute the probability $p(x_i,x_{i+1},h)$, and then simulate a variable $U$ distributed uniformly in the interval $\left[0,1\right]$, thus obtaining a realization $u$. Hence, we counclude that the particle has left the domain for a time $t$ in $(t_i,t_{i+1})$ if $u$ is smaller than $p$. Therefore, we approximate the exit time as
\begin{equation}\label{eq:TauCEM}
	\tau_h^c = \min \{T,\min\{t_i = hi \colon X_h(t_i) \notin D\}, \min\{t_i = hi \colon u < p(x_{i-1},x_i,h) \}\},
\end{equation}
In the same way as in DEM, we can approximate $\phi$ as
\begin{equation}\label{eq:PhiCEM}
	\phi_h^c = \mathbbm{1}_{\{\tau_h^c < T\}}F(X_h^c(T)).
\end{equation}
We show the pseudocode for the implementation of CEM in Algorithm \ref{alg:algoCEM}.

\begin{algorithm}[t]
\caption{Continuous Euler-Maruyama}
\For{$t_i \in P_h$ }{
	Compute $X(t_{i+1})$ with one step of DEM \;
  	\eIf{$X(t_{i+1}) \notin D$}{
    		$\tau_h^c = t_{i+1}$ \;
		$\phi_h^c = F(X_h^c(t_{i+1})$ \;
		\Return \;
   	}{
   	compute $p = p(x_i,x_{i+1},h)$ \;
	simulate $u \sim$ Unif$(0,1)$ \;
	\If{$u < p$}{
		$\tau_h^c = t_{i+1}$ \;
		$\phi_h^c = F(X_h^c(t_{i+1})$ \;
		\Return \;
		}
  	}
 }
\label{alg:algoCEM}
\end{algorithm}

\noindent The weak error of this method has been studied exhaustively in previous work.
\begin{theorem}\label{ThCEMPhi} Under appropriate smoothness assumptions, 
\begin{equation}\label{eq:ConvCEMPhi}
	|\mathbb{E}(\phi_h^c) - \mathbb{E}(\phi)| = O(h).
\end{equation}
\end{theorem}
A proof of result \ref{ThCEMPhi} can be found in \cite{Gobet2001}.

\subsubsection{Reflecting boundaries}
The reflecting boundaries are treated in the same way for both DEM and CEM. Let us denote by $\Gamma_k$ and $\Gamma_r$ the killing and reflecting subsets of $\partial D$, \textit{i.e.}
\begin{equation}\label{eq:Boundaries}
	\Gamma_r \cup \Gamma_k = \partial D, \quad \Gamma_r \cap \Gamma_k = \emptyset
\end{equation} 
In case the particle approaches $\Gamma_k$ the exit is treated as above. If for a timestep of $t_i \in P_h$, $X(t_i)$ is not in $D$ and has crossed $\Gamma_r$ at a time $t_{i-1} < t < t_i$, we update the solution to be the normal reflection inside $D$ of $X(t_i)$.




